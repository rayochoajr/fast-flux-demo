{"version":3,"file":"../app/api/generate-image/route.js","mappings":"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","sources":["webpack://ai-image-generator/./node_modules/replicate/lib/ sync","webpack://ai-image-generator/external commonjs \"@sentry/nextjs\"","webpack://ai-image-generator/external commonjs \"next/dist/client/components/request-async-storage.external.js\"","webpack://ai-image-generator/external commonjs \"next/dist/compiled/next-server/app-route.runtime.prod.js\"","webpack://ai-image-generator/app/api/generate-image/route.ts","webpack://ai-image-generator/sentry-wrapper-module","webpack://ai-image-generator/?5d26","webpack://ai-image-generator/./sentry.server.config.ts","webpack://ai-image-generator/<anon>"],"sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 81036;\nmodule.exports = webpackEmptyContext;","module.exports = require(\"@sentry/nextjs\");","module.exports = require(\"next/dist/client/components/request-async-storage.external.js\");","module.exports = require(\"next/dist/compiled/next-server/app-route.runtime.prod.js\");","import { NextResponse } from \"next/server\";\nimport Replicate from \"replicate\";\nimport { captureException } from '@sentry/nextjs';\n\nexport async function GET(request: Request) {\n  try {\n    if (!process.env.REPLICATE_API_TOKEN) {\n      throw new Error('REPLICATE_API_TOKEN is not configured');\n    }\n\n    const replicate = new Replicate({\n      auth: process.env.REPLICATE_API_TOKEN,\n    });\n\n    const { searchParams } = new URL(request.url);\n    const prompt = searchParams.get(\"text\");\n\n    if (!prompt) {\n      return new NextResponse('Missing text parameter', { status: 400 });\n    }\n\n    const model = \"black-forest-labs/flux-schnell\";\n    const input = {\n      prompt,\n      go_fast: true,\n      num_outputs: 1,\n      aspect_ratio: \"1:1\",\n      output_format: \"webp\",\n      output_quality: 80,\n      megapixels: \"0.25\",\n      num_inference_steps: 2,\n    };\n\n    const output = await replicate.run(model, { input }) as string[];\n    \n    if (!output || !output[0]) {\n      throw new Error('No output from Replicate');\n    }\n\n    const headers = new Headers();\n    headers.set(\"Content-Type\", \"image/*\");\n    headers.set(\n      \"Cache-Control\",\n      \"no-store, no-cache, must-revalidate, proxy-revalidate\"\n    );\n    headers.set(\"Pragma\", \"no-cache\");\n    headers.set(\"Expires\", \"0\");\n\n    return new NextResponse(output[0], {\n      status: 200,\n      statusText: \"OK\",\n      headers,\n    });\n  } catch (error) {\n    console.error('Image generation error:', error);\n    captureException(error);\n    return new NextResponse(\n      JSON.stringify({ error: 'Failed to generate image' }), \n      { \n        status: 500,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }\n    );\n  }\n}\n","import { _nullishCoalesce, _optionalChain } from '@sentry/utils';\nimport * as Sentry from '@sentry/nextjs';\nimport { requestAsyncStorage } from 'next/dist/client/components/request-async-storage.external.js';\nimport * as serverComponentModule from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport * from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\nexport {} from '__SENTRY_WRAPPING_TARGET_FILE__.cjs';\n\nfunction wrapHandler(handler, method) {\n  // Running the instrumentation code during the build phase will mark any function as \"dynamic\" because we're accessing\n  // the Request object. We do not want to turn handlers dynamic so we skip instrumentation in the build phase.\n  if (process.env.NEXT_PHASE === 'phase-production-build') {\n    return handler;\n  }\n\n  if (typeof handler !== 'function') {\n    return handler;\n  }\n\n  return new Proxy(handler, {\n    apply: (originalFunction, thisArg, args) => {\n      let sentryTraceHeader = undefined;\n      let baggageHeader = undefined;\n      let headers = undefined;\n\n      // We try-catch here just in case the API around `requestAsyncStorage` changes unexpectedly since it is not public API\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        const requestAsyncStore = requestAsyncStorage.getStore() ;\n        sentryTraceHeader = _nullishCoalesce(_optionalChain([requestAsyncStore, 'optionalAccess', _ => _.headers, 'access', _2 => _2.get, 'call', _3 => _3('sentry-trace')]), () => ( undefined));\n        baggageHeader = _nullishCoalesce(_optionalChain([requestAsyncStore, 'optionalAccess', _4 => _4.headers, 'access', _5 => _5.get, 'call', _6 => _6('baggage')]), () => ( undefined));\n        headers = _optionalChain([requestAsyncStore, 'optionalAccess', _7 => _7.headers]);\n      } catch (e) {\n        /** empty */\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n      return Sentry.wrapRouteHandlerWithSentry(originalFunction , {\n        method,\n        parameterizedRoute: '/api/generate-image',\n        sentryTraceHeader,\n        baggageHeader,\n        headers,\n      }).apply(thisArg, args);\n    },\n  });\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst GET = wrapHandler(serverComponentModule.GET , 'GET');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst POST = wrapHandler(serverComponentModule.POST , 'POST');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PUT = wrapHandler(serverComponentModule.PUT , 'PUT');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst PATCH = wrapHandler(serverComponentModule.PATCH , 'PATCH');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst DELETE = wrapHandler(serverComponentModule.DELETE , 'DELETE');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst HEAD = wrapHandler(serverComponentModule.HEAD , 'HEAD');\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nconst OPTIONS = wrapHandler(serverComponentModule.OPTIONS , 'OPTIONS');\n\nexport { DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT };\n","import \"next/dist/server/node-polyfill-headers\";\nimport { AppRouteRouteModule } from \"next/dist/server/future/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/future/route-kind\";\nimport * as userland from \"/codebuild/output/src2780279085/src/fast-flux-demo/app/api/generate-image/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/generate-image/route\",\n        pathname: \"/api/generate-image\",\n        filename: \"route\",\n        bundlePath: \"app/api/generate-image/route\"\n    },\n    resolvedPagePath: \"/codebuild/output/src2780279085/src/fast-flux-demo/app/api/generate-image/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/generate-image/route\";\nexport { routeModule, requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout, originalPathname,  };\n\n//# sourceMappingURL=app-route.js.map","var _sentryCollisionFreeGlobalObject = typeof window != \"undefined\" ? window : typeof global != \"undefined\" ? global : typeof self != \"undefined\" ? self : {};\n_sentryCollisionFreeGlobalObject[\"__sentryRewritesTunnelPath__\"] = undefined;\n_sentryCollisionFreeGlobalObject[\"SENTRY_RELEASE\"] = {\"id\":\"9cE2t8EeJLM5SxMI0LDvt\"};\n_sentryCollisionFreeGlobalObject[\"__sentryBasePath\"] = undefined;\n_sentryCollisionFreeGlobalObject[\"__rewriteFramesDistDir__\"] = \".next\";\n\nimport * as Sentry from '@sentry/nextjs';\n\nSentry.init({\n  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,\n  tracesSampleRate: 1.0,\n}); "],"names":["webpackEmptyContext","req","e","code","keys","resolve","id","module","exports","require","GET","request","process","env","REPLICATE_API_TOKEN","replicate","Replicate","auth","searchParams","URL","url","prompt","get","NextResponse","status","output","run","input","go_fast","num_outputs","aspect_ratio","output_format","output_quality","megapixels","num_inference_steps","headers","Headers","set","statusText","error","captureException","JSON","stringify","wrapHandler","handler","method","NEXT_PHASE","Proxy","apply","originalFunction","thisArg","args","sentryTraceHeader","baggageHeader","requestAsyncStore","request_async_storage_external_js_","requestAsyncStorage","getStore","cjs","hd","xY","_","_2","_3","undefined","_4","_5","_6","_7","nextjs_","wrapRouteHandlerWithSentry","parameterizedRoute","serverComponentModule.GET","POST","serverComponentModule.POST","PUT","serverComponentModule.PUT","PATCH","serverComponentModule.PATCH","DELETE","serverComponentModule.DELETE","HEAD","serverComponentModule.HEAD","OPTIONS","serverComponentModule.OPTIONS","routeModule","module_compiled","AppRouteRouteModule","definition","kind","route_kind","x","APP_ROUTE","page","pathname","filename","bundlePath","resolvedPagePath","nextConfigOutput","userland","route_namespaceObject","staticGenerationAsyncStorage","serverHooks","headerHooks","staticGenerationBailout","originalPathname","_sentryCollisionFreeGlobalObject","global","self","Sentry","dsn","NEXT_PUBLIC_SENTRY_DSN","tracesSampleRate"],"sourceRoot":""}