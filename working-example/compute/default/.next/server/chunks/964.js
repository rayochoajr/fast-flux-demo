"use strict";exports.id=964,exports.ids=[964],exports.modules={12048:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,s={};function stringifyCookie(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean);return`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}; ${r.join("; ")}`}function parseCookie(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[i,n]=[r.slice(0,e),r.slice(e+1)];try{t.set(i,decodeURIComponent(null!=n?n:"true"))}catch{}}return t}function parseSetCookie(e){var t,r;if(!e)return;let[[i,n],...s]=parseCookie(e),{domain:l,expires:u,httponly:c,maxage:d,path:h,samesite:p,secure:f,priority:m}=Object.fromEntries(s.map(([e,t])=>[e.toLowerCase(),t])),g={name:i,value:decodeURIComponent(n),domain:l,...u&&{expires:new Date(u)},...c&&{httpOnly:!0},..."string"==typeof d&&{maxAge:Number(d)},path:h,...p&&{sameSite:a.includes(t=(t=p).toLowerCase())?t:void 0},...f&&{secure:!0},...m&&{priority:o.includes(r=(r=m).toLowerCase())?r:void 0}};return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}(g)}((e,r)=>{for(var i in r)t(e,i,{get:r[i],enumerable:!0})})(s,{RequestCookies:()=>l,ResponseCookies:()=>u,parseCookie:()=>parseCookie,parseSetCookie:()=>parseSetCookie,stringifyCookie:()=>stringifyCookie}),e.exports=((e,s,a,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let a of i(s))n.call(e,a)||void 0===a||t(e,a,{get:()=>s[a],enumerable:!(o=r(s,a))||o.enumerable});return e})(t({},"__esModule",{value:!0}),s);var a=["strict","lax","none"],o=["low","medium","high"],l=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t){let e=parseCookie(t);for(let[t,r]of e)this._parsed.set(t,{name:t,value:r})}}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let i="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===i).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,i=this._parsed;return i.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(i).map(([e,t])=>stringifyCookie(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>stringifyCookie(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},u=class{constructor(e){var t,r,i;this._parsed=new Map,this._headers=e;let n=null!=(i=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?i:[],s=Array.isArray(n)?n:function(e){if(!e)return[];var t,r,i,n,s,a=[],o=0;function skipWhitespace(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,s=!1;skipWhitespace();)if(","===(r=e.charAt(o))){for(i=o,o+=1,skipWhitespace(),n=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(s=!0,o=n,a.push(e.substring(t,i)),t=o):o=i+1}else o+=1;(!s||o>=e.length)&&a.push(e.substring(t,e.length))}return a}(n);for(let e of s){let t=parseSetCookie(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let i="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===i)}has(e){return this._parsed.has(e)}set(...e){let[t,r,i]=1===e.length?[e[0].name,e[0].value,e[0]]:e,n=this._parsed;return n.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...i})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=stringifyCookie(r);t.append("set-cookie",e)}}(n,this._headers),this}delete(...e){let[t,r,i]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:r,domain:i,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(stringifyCookie).join("; ")}}},75889:(e,t,r)=>{Object.defineProperty(t,"Z",{enumerable:!0,get:function(){return i.NextResponse}});let i=r(22452)},84474:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NextURL",{enumerable:!0,get:function(){return NextURL}});let i=r(12945),n=r(33619),s=r(41528),a=r(61269),o=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function parseURL(e,t){return new URL(String(e).replace(o,"localhost"),t&&String(t).replace(o,"localhost"))}let l=Symbol("NextURLInternal");let NextURL=class NextURL{constructor(e,t,r){let i,n;"object"==typeof t&&"pathname"in t||"string"==typeof t?(i=t,n=r||{}):n=r||t||{},this[l]={url:parseURL(e,i??n.base),options:n,basePath:""},this.analyze()}analyze(){var e,t,r,n,o;let u=(0,a.getNextPathnameInfo)(this[l].url.pathname,{nextConfig:this[l].options.nextConfig,parseData:!0,i18nProvider:this[l].options.i18nProvider}),c=(0,s.getHostname)(this[l].url,this[l].options.headers);this[l].domainLocale=this[l].options.i18nProvider?this[l].options.i18nProvider.detectDomainLocale(c):(0,i.detectDomainLocale)(null==(t=this[l].options.nextConfig)?void 0:null==(e=t.i18n)?void 0:e.domains,c);let d=(null==(r=this[l].domainLocale)?void 0:r.defaultLocale)||(null==(o=this[l].options.nextConfig)?void 0:null==(n=o.i18n)?void 0:n.defaultLocale);this[l].url.pathname=u.pathname,this[l].defaultLocale=d,this[l].basePath=u.basePath??"",this[l].buildId=u.buildId,this[l].locale=u.locale??d,this[l].trailingSlash=u.trailingSlash}formatPathname(){return(0,n.formatNextPathnameInfo)({basePath:this[l].basePath,buildId:this[l].buildId,defaultLocale:this[l].options.forceLocale?void 0:this[l].defaultLocale,locale:this[l].locale,pathname:this[l].url.pathname,trailingSlash:this[l].trailingSlash})}formatSearch(){return this[l].url.search}get buildId(){return this[l].buildId}set buildId(e){this[l].buildId=e}get locale(){return this[l].locale??""}set locale(e){var t,r;if(!this[l].locale||!(null==(r=this[l].options.nextConfig)?void 0:null==(t=r.i18n)?void 0:t.locales.includes(e)))throw TypeError(`The NextURL configuration includes no locale "${e}"`);this[l].locale=e}get defaultLocale(){return this[l].defaultLocale}get domainLocale(){return this[l].domainLocale}get searchParams(){return this[l].url.searchParams}get host(){return this[l].url.host}set host(e){this[l].url.host=e}get hostname(){return this[l].url.hostname}set hostname(e){this[l].url.hostname=e}get port(){return this[l].url.port}set port(e){this[l].url.port=e}get protocol(){return this[l].url.protocol}set protocol(e){this[l].url.protocol=e}get href(){let e=this.formatPathname(),t=this.formatSearch();return`${this.protocol}//${this.host}${e}${t}${this.hash}`}set href(e){this[l].url=parseURL(e),this.analyze()}get origin(){return this[l].url.origin}get pathname(){return this[l].url.pathname}set pathname(e){this[l].url.pathname=e}get hash(){return this[l].url.hash}set hash(e){this[l].url.hash=e}get search(){return this[l].url.search}set search(e){this[l].url.search=e}get password(){return this[l].url.password}set password(e){this[l].url.password=e}get username(){return this[l].url.username}set username(e){this[l].url.username=e}get basePath(){return this[l].basePath}set basePath(e){this[l].basePath=e.startsWith("/")?e:`/${e}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new NextURL(String(this),this[l].options)}}},3508:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RequestCookies:function(){return i.RequestCookies},ResponseCookies:function(){return i.ResponseCookies}});let i=r(12048)},22452:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NextResponse",{enumerable:!0,get:function(){return NextResponse}});let i=r(84474),n=r(12138),s=r(3508),a=Symbol("internal response"),o=new Set([301,302,303,307,308]);function handleMiddlewareField(e,t){var r;if(null==e?void 0:null==(r=e.request)?void 0:r.headers){if(!(e.request.headers instanceof Headers))throw Error("request.headers must be an instance of Headers");let r=[];for(let[i,n]of e.request.headers)t.set("x-middleware-request-"+i,n),r.push(i);t.set("x-middleware-override-headers",r.join(","))}}let NextResponse=class NextResponse extends Response{constructor(e,t={}){super(e,t),this[a]={cookies:new s.ResponseCookies(this.headers),url:t.url?new i.NextURL(t.url,{headers:(0,n.toNodeOutgoingHttpHeaders)(this.headers),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[a].cookies}static json(e,t){let r=Response.json(e,t);return new NextResponse(r.body,r)}static redirect(e,t){let r="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!o.has(r))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');let i="object"==typeof t?t:{},s=new Headers(null==i?void 0:i.headers);return s.set("Location",(0,n.validateURL)(e)),new NextResponse(null,{...i,headers:s,status:r})}static rewrite(e,t){let r=new Headers(null==t?void 0:t.headers);return r.set("x-middleware-rewrite",(0,n.validateURL)(e)),handleMiddlewareField(t,r),new NextResponse(null,{...t,headers:r})}static next(e){let t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),handleMiddlewareField(e,t),new NextResponse(null,{...e,headers:t})}}},12138:(e,t)=>{function fromNodeOutgoingHttpHeaders(e){let t=new Headers;for(let[r,i]of Object.entries(e)){let e=Array.isArray(i)?i:[i];for(let i of e)void 0!==i&&("number"==typeof i&&(i=i.toString()),t.append(r,i))}return t}function splitCookiesString(e){var t,r,i,n,s,a=[],o=0;function skipWhitespace(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,s=!1;skipWhitespace();)if(","===(r=e.charAt(o))){for(i=o,o+=1,skipWhitespace(),n=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(s=!0,o=n,a.push(e.substring(t,i)),t=o):o=i+1}else o+=1;(!s||o>=e.length)&&a.push(e.substring(t,e.length))}return a}function toNodeOutgoingHttpHeaders(e){let t={},r=[];if(e)for(let[i,n]of e.entries())"set-cookie"===i.toLowerCase()?(r.push(...splitCookiesString(n)),t[i]=1===r.length?r[0]:r):t[i]=n;return t}function validateURL(e){try{return String(new URL(String(e)))}catch(t){throw Error(`URL is malformed "${String(e)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:t})}}Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{fromNodeOutgoingHttpHeaders:function(){return fromNodeOutgoingHttpHeaders},splitCookiesString:function(){return splitCookiesString},toNodeOutgoingHttpHeaders:function(){return toNodeOutgoingHttpHeaders},validateURL:function(){return validateURL}})},41528:(e,t)=>{function getHostname(e,t){let r;if((null==t?void 0:t.host)&&!Array.isArray(t.host))r=t.host.toString().split(":")[0];else{if(!e.hostname)return;r=e.hostname}return r.toLowerCase()}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getHostname",{enumerable:!0,get:function(){return getHostname}})},12945:(e,t)=>{function detectDomainLocale(e,t,r){if(e)for(let s of(r&&(r=r.toLowerCase()),e)){var i,n;let e=null==(i=s.domain)?void 0:i.split(":")[0].toLowerCase();if(t===e||r===s.defaultLocale.toLowerCase()||(null==(n=s.locales)?void 0:n.some(e=>e.toLowerCase()===r)))return s}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"detectDomainLocale",{enumerable:!0,get:function(){return detectDomainLocale}})},1491:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addLocale",{enumerable:!0,get:function(){return addLocale}});let i=r(44534),n=r(34250);function addLocale(e,t,r,s){if(!t||t===r)return e;let a=e.toLowerCase();return!s&&((0,n.pathHasPrefix)(a,"/api")||(0,n.pathHasPrefix)(a,"/"+t.toLowerCase()))?e:(0,i.addPathPrefix)(e,"/"+t)}},44534:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addPathPrefix",{enumerable:!0,get:function(){return addPathPrefix}});let i=r(47043);function addPathPrefix(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:n,hash:s}=(0,i.parsePath)(e);return""+t+r+n+s}},17824:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addPathSuffix",{enumerable:!0,get:function(){return addPathSuffix}});let i=r(47043);function addPathSuffix(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:n,hash:s}=(0,i.parsePath)(e);return""+r+t+n+s}},33619:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"formatNextPathnameInfo",{enumerable:!0,get:function(){return formatNextPathnameInfo}});let i=r(52810),n=r(44534),s=r(17824),a=r(1491);function formatNextPathnameInfo(e){let t=(0,a.addLocale)(e.pathname,e.locale,e.buildId?void 0:e.defaultLocale,e.ignorePrefix);return(e.buildId||!e.trailingSlash)&&(t=(0,i.removeTrailingSlash)(t)),e.buildId&&(t=(0,s.addPathSuffix)((0,n.addPathPrefix)(t,"/_next/data/"+e.buildId),"/"===e.pathname?"index.json":".json")),t=(0,n.addPathPrefix)(t,e.basePath),!e.buildId&&e.trailingSlash?t.endsWith("/")?t:(0,s.addPathSuffix)(t,"/"):(0,i.removeTrailingSlash)(t)}},61269:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getNextPathnameInfo",{enumerable:!0,get:function(){return getNextPathnameInfo}});let i=r(36737),n=r(77125),s=r(34250);function getNextPathnameInfo(e,t){var r,a;let{basePath:o,i18n:l,trailingSlash:u}=null!=(r=t.nextConfig)?r:{},c={pathname:e,trailingSlash:"/"!==e?e.endsWith("/"):u};o&&(0,s.pathHasPrefix)(c.pathname,o)&&(c.pathname=(0,n.removePathPrefix)(c.pathname,o),c.basePath=o);let d=c.pathname;if(c.pathname.startsWith("/_next/data/")&&c.pathname.endsWith(".json")){let e=c.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),r=e[0];c.buildId=r,d="index"!==e[1]?"/"+e.slice(1).join("/"):"/",!0===t.parseData&&(c.pathname=d)}if(l){let e=t.i18nProvider?t.i18nProvider.analyze(c.pathname):(0,i.normalizeLocalePath)(c.pathname,l.locales);c.locale=e.detectedLocale,c.pathname=null!=(a=e.pathname)?a:c.pathname,!e.detectedLocale&&c.buildId&&(e=t.i18nProvider?t.i18nProvider.analyze(d):(0,i.normalizeLocalePath)(d,l.locales)).detectedLocale&&(c.locale=e.detectedLocale)}return c}},47043:(e,t)=>{function parsePath(e){let t=e.indexOf("#"),r=e.indexOf("?"),i=r>-1&&(t<0||r<t);return i||t>-1?{pathname:e.substring(0,i?r:t),query:i?e.substring(r,t>-1?t:void 0):"",hash:t>-1?e.slice(t):""}:{pathname:e,query:"",hash:""}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"parsePath",{enumerable:!0,get:function(){return parsePath}})},34250:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"pathHasPrefix",{enumerable:!0,get:function(){return pathHasPrefix}});let i=r(47043);function pathHasPrefix(e,t){if("string"!=typeof e)return!1;let{pathname:r}=(0,i.parsePath)(e);return r===t||r.startsWith(t+"/")}},77125:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removePathPrefix",{enumerable:!0,get:function(){return removePathPrefix}});let i=r(34250);function removePathPrefix(e,t){if(!(0,i.pathHasPrefix)(e,t))return e;let r=e.slice(t.length);return r.startsWith("/")?r:"/"+r}},2454:(e,t,r)=>{let i=r(89761),n=r(22942),{createReadableStream:s,createFileOutput:a}=r(79443),{transform:o,withAutomaticRetries:l,validateWebhook:u,parseProgressFromLogs:c,streamAsyncIterator:d}=r(44037),h=r(42147),p=r(88953),f=r(87910),m=r(46402),g=r(96498),y=r(67031),b=r(23175),w=r(96130),v=r(52968),P=r(69637);e.exports=class{constructor(e={}){this.auth=e.auth||("undefined"!=typeof process?process.env.REPLICATE_API_TOKEN:null),this.userAgent=e.userAgent||`replicate-javascript/${P.version}`,this.baseUrl=e.baseUrl||"https://api.replicate.com/v1",this.fetch=e.fetch||globalThis.fetch,this.fileEncodingStrategy=e.fileEncodingStrategy||"default",this.useFileOutput=e.useFileOutput||!1,this.accounts={current:h.current.bind(this)},this.collections={list:p.list.bind(this),get:p.get.bind(this)},this.deployments={get:f.get.bind(this),create:f.create.bind(this),update:f.update.bind(this),delete:f.delete.bind(this),list:f.list.bind(this),predictions:{create:f.predictions.create.bind(this)}},this.files={create:m.create.bind(this),get:m.get.bind(this),list:m.list.bind(this),delete:m.delete.bind(this)},this.hardware={list:g.list.bind(this)},this.models={get:y.get.bind(this),list:y.list.bind(this),create:y.create.bind(this),versions:{list:y.versions.list.bind(this),get:y.versions.get.bind(this)},search:y.search.bind(this)},this.predictions={create:b.create.bind(this),get:b.get.bind(this),cancel:b.cancel.bind(this),list:b.list.bind(this)},this.trainings={create:w.create.bind(this),get:w.get.bind(this),cancel:w.cancel.bind(this),list:w.list.bind(this)},this.webhooks={default:{secret:{get:v.default.secret.get.bind(this)}}}}async run(e,t,r){let i;let{wait:s,signal:l,...u}=t,c=n.parse(e),d="boolean"==typeof s||"number"==typeof s;if(c.version)i=await this.predictions.create({...u,version:c.version,wait:!!d&&s});else if(c.owner&&c.name)i=await this.predictions.create({...u,model:`${c.owner}/${c.name}`,wait:!!d&&s});else throw Error("Invalid model version identifier");r&&r(i);let h=d&&"starting"!==i.status;if(h||(i=await this.wait(i,d?{}:s,async e=>(r&&r(e),!!l&&!!l.aborted))),l&&l.aborted&&(i=await this.predictions.cancel(i.id)),r&&r(i),"failed"===i.status)throw Error(`Prediction failed: ${i.error}`);return o(i.output,e=>"string"==typeof e&&(e.startsWith("https:")||e.startsWith("data:"))&&this.useFileOutput?a({url:e,fetch:this.fetch}):e)}async request(e,t){let r,n;let{auth:s,baseUrl:a,userAgent:o}=this;r=e instanceof URL?e:new URL(e.startsWith("/")?e.slice(1):e,a.endsWith("/")?a:`${a}/`);let{method:u="GET",params:c={},data:d}=t;for(let[e,t]of Object.entries(c))r.searchParams.append(e,t);let h={"Content-Type":"application/json","User-Agent":o};if(s&&(h.Authorization=`Bearer ${s}`),t.headers)for(let[e,r]of Object.entries(t.headers))h[e]=r;d instanceof FormData?(n=d,delete h["Content-Type"]):d&&(n=JSON.stringify(d));let p={method:u,headers:h,body:n},f=this.fetch,m=await l(async()=>f(r,p),{shouldRetry:"GET"===u?e=>429===e.status||e.status>=500:e=>429===e.status});if(!m.ok){let e=new Request(r,p),t=await m.text();throw new i(`Request to ${r} failed with status ${m.status} ${m.statusText}: ${t}.`,e,m)}return m}async *stream(e,t){let r;let{wait:i,signal:a,...o}=t,l=n.parse(e);if(l.version)r=await this.predictions.create({...o,version:l.version});else if(l.owner&&l.name)r=await this.predictions.create({...o,model:`${l.owner}/${l.name}`});else throw Error("Invalid model version identifier");if(r.urls&&r.urls.stream){let e=s({url:r.urls.stream,fetch:this.fetch,...a?{options:{signal:a}}:{}});yield*d(e)}else throw Error("Prediction does not support streaming")}async *paginate(e){let t=await e();yield t.results,t.next&&(yield*this.paginate(()=>this.request(t.next,{method:"GET"}).then(e=>e.json())))}async wait(e,t,r){let{id:i}=e;if(!i)throw Error("Invalid prediction");if("succeeded"===e.status||"failed"===e.status||"canceled"===e.status)return e;let sleep=e=>new Promise(t=>setTimeout(t,e)),n=t&&t.interval||500,s=await this.predictions.get(i);for(;"succeeded"!==s.status&&"failed"!==s.status&&"canceled"!==s.status&&(!r||await r(s)!==!0);)await sleep(n),s=await this.predictions.get(e.id);if("failed"===s.status)throw Error(`Prediction failed: ${s.error}`);return s}},e.exports.validateWebhook=u,e.exports.parseProgressFromLogs=c},42147:e=>{async function getCurrentAccount(){let e=await this.request("/account",{method:"GET"});return e.json()}e.exports={current:getCurrentAccount}},88953:e=>{async function getCollection(e){let t=await this.request(`/collections/${e}`,{method:"GET"});return t.json()}async function listCollections(){let e=await this.request("/collections",{method:"GET"});return e.json()}e.exports={get:getCollection,list:listCollections}},87910:(e,t,r)=>{let{transformFileInputs:i}=r(44037);async function createPrediction(e,t,r){let{input:n,block:s,...a}=r;if(a.webhook)try{new URL(a.webhook)}catch(e){throw Error("Invalid webhook URL")}let o={};s&&(o.Prefer="wait");let l=await this.request(`/deployments/${e}/${t}/predictions`,{method:"POST",headers:o,data:{...a,input:await i(this,n,this.fileEncodingStrategy)}});return l.json()}async function getDeployment(e,t){let r=await this.request(`/deployments/${e}/${t}`,{method:"GET"});return r.json()}async function createDeployment(e){let t=await this.request("/deployments",{method:"POST",data:e});return t.json()}async function updateDeployment(e,t,r){let i=await this.request(`/deployments/${e}/${t}`,{method:"PATCH",data:r});return i.json()}async function deleteDeployment(e,t){let r=await this.request(`/deployments/${e}/${t}`,{method:"DELETE"});return 204===r.status}async function listDeployments(){let e=await this.request("/deployments",{method:"GET"});return e.json()}e.exports={predictions:{create:createPrediction},get:getDeployment,create:createDeployment,update:updateDeployment,list:listDeployments,delete:deleteDeployment}},89761:e=>{e.exports=class extends Error{constructor(e,t,r){super(e),this.name="ApiError",this.request=t,this.response=r}}},46402:e=>{async function createFile(e,t={}){let r,i;let n=new FormData;if(e instanceof Blob)r=e.name||`blob_${Date.now()}`,i=e;else if(Buffer.isBuffer(e)){r=`buffer_${Date.now()}`;let t=new Uint8Array(e);i=new Blob([t],{type:"application/octet-stream",name:r})}else throw Error("Invalid file argument, must be a Blob, File or Buffer");n.append("content",i,r),n.append("metadata",new Blob([JSON.stringify(t)],{type:"application/json"}));let s=await this.request("/files",{method:"POST",data:n,headers:{"Content-Type":"multipart/form-data"}});return s.json()}async function listFiles(){let e=await this.request("/files",{method:"GET"});return e.json()}async function getFile(e){let t=await this.request(`/files/${e}`,{method:"GET"});return t.json()}async function deleteFile(e){let t=await this.request(`/files/${e}`,{method:"DELETE"});return 204===t.status}e.exports={create:createFile,list:listFiles,get:getFile,delete:deleteFile}},96498:e=>{async function listHardware(){let e=await this.request("/hardware",{method:"GET"});return e.json()}e.exports={list:listHardware}},22942:e=>{let ModelVersionIdentifier=class ModelVersionIdentifier{constructor(e,t,r=null){this.owner=e,this.name=t,this.version=r}static parse(e){let t=e.match(/^(?<owner>[^/]+)\/(?<name>[^/:]+)(:(?<version>.+))?$/);if(!t)throw Error(`Invalid reference to model version: ${e}. Expected format: owner/name or owner/name:version`);let{owner:r,name:i,version:n}=t.groups;return new ModelVersionIdentifier(r,i,n)}};e.exports=ModelVersionIdentifier},67031:e=>{async function getModel(e,t){let r=await this.request(`/models/${e}/${t}`,{method:"GET"});return r.json()}async function listModelVersions(e,t){let r=await this.request(`/models/${e}/${t}/versions`,{method:"GET"});return r.json()}async function getModelVersion(e,t,r){let i=await this.request(`/models/${e}/${t}/versions/${r}`,{method:"GET"});return i.json()}async function listModels(){let e=await this.request("/models",{method:"GET"});return e.json()}async function createModel(e,t,r){let i={owner:e,name:t,...r},n=await this.request("/models",{method:"POST",data:i});return n.json()}async function search(e){let t=await this.request("/models",{method:"QUERY",headers:{"Content-Type":"text/plain"},data:e});return t.json()}e.exports={get:getModel,list:listModels,create:createModel,versions:{list:listModelVersions,get:getModelVersion},search}},23175:(e,t,r)=>{let{transformFileInputs:i}=r(44037);async function createPrediction(e){let t;let{model:r,version:n,input:s,wait:a,...o}=e;if(o.webhook)try{new URL(o.webhook)}catch(e){throw Error("Invalid webhook URL")}let l={};if(a){if("number"==typeof a){let e=Math.max(1,Math.ceil(Number(a))||1);l.Prefer=`wait=${e}`}else l.Prefer="wait"}if(n)t=await this.request("/predictions",{method:"POST",headers:l,data:{...o,input:await i(this,s,this.fileEncodingStrategy),version:n}});else if(r)t=await this.request(`/models/${r}/predictions`,{method:"POST",headers:l,data:{...o,input:await i(this,s,this.fileEncodingStrategy)}});else throw Error("Either model or version must be specified");return t.json()}async function getPrediction(e){let t=await this.request(`/predictions/${e}`,{method:"GET"});return t.json()}async function cancelPrediction(e){let t=await this.request(`/predictions/${e}/cancel`,{method:"POST"});return t.json()}async function listPredictions(){let e=await this.request("/predictions",{method:"GET"});return e.json()}e.exports={create:createPrediction,get:getPrediction,cancel:cancelPrediction,list:listPredictions}},79443:(e,t,r)=>{let i=r(89761),{streamAsyncIterator:n}=r(44037),{EventSourceParserStream:s}=r(86035),{TextDecoderStream:a}=void 0===globalThis.TextDecoderStream?r(93761):globalThis;let ServerSentEvent=class ServerSentEvent{constructor(e,t,r,i){this.event=e,this.data=t,this.id=r,this.retry=i}toString(){return"output"===this.event?this.data:""}};function createFileOutput({url:e,fetch:t}){let r="application/octet-stream";let FileOutput=class FileOutput extends ReadableStream{async blob(){let e=[];for await(let t of this)e.push(t);return new Blob(e,{type:r})}url(){return new URL(e)}toString(){return e}};return new FileOutput({async start(s){let a=await t(e);if(!a.ok){let t=await a.text(),r=new Request(e,init);s.error(new i(`Request to ${e} failed with status ${a.status}: ${t}`,r,a))}a.headers.get("Content-Type")&&(r=a.headers.get("Content-Type"));try{for await(let e of n(a.body))s.enqueue(e);s.close()}catch(e){s.error(e)}}})}e.exports={createFileOutput,createReadableStream:function({url:e,fetch:t,options:r={}}){let{useFileOutput:o=!0,headers:l={},...u}=r;return new ReadableStream({async start(r){let c={...u,headers:{...l,Accept:"text/event-stream"}},d=await t(e,c);if(!d.ok){let t=await d.text(),n=new Request(e,c);r.error(new i(`Request to ${e} failed with status ${d.status}: ${t}`,n,d))}let h=d.body.pipeThrough(new a).pipeThrough(new s);for await(let e of n(h)){if("error"===e.event){r.error(Error(e.data));break}let i=e.data;if(o&&"string"==typeof i&&(i.startsWith("https:")||i.startsWith("data:"))&&(i=createFileOutput({data:i,fetch:t})),r.enqueue(new ServerSentEvent(e.event,i,e.id)),"done"===e.event)break}r.close()}})},ServerSentEvent}},96130:e=>{async function createTraining(e,t,r,i){let{...n}=i;if(n.webhook)try{new URL(n.webhook)}catch(e){throw Error("Invalid webhook URL")}let s=await this.request(`/models/${e}/${t}/versions/${r}/trainings`,{method:"POST",data:n});return s.json()}async function getTraining(e){let t=await this.request(`/trainings/${e}`,{method:"GET"});return t.json()}async function cancelTraining(e){let t=await this.request(`/trainings/${e}/cancel`,{method:"POST"});return t.json()}async function listTrainings(){let e=await this.request("/trainings",{method:"GET"});return e.json()}e.exports={create:createTraining,get:getTraining,cancel:cancelTraining,list:listTrainings}},44037:(e,t,r)=>{let i=r(89761),{create:n}=r(46402);async function validateWebhook(e,t){let{id:r,timestamp:i,body:n,signature:s}=e,a=t||e.secret;if(e&&e.headers&&e.body&&("function"==typeof e.headers.get?(r=e.headers.get("webhook-id"),i=e.headers.get("webhook-timestamp"),s=e.headers.get("webhook-signature")):(r=e.headers["webhook-id"],i=e.headers["webhook-timestamp"],s=e.headers["webhook-signature"]),n=e.body),n instanceof ReadableStream||n.readable)try{n=await new Response(n).text()}catch(e){throw Error(`Error reading body: ${e.message}`)}else if(isTypedArray(n))n=await new Blob([n]).text();else if("object"==typeof n)n=JSON.stringify(n);else if("string"!=typeof n)throw Error("Invalid body type");if(!r||!i||!s)throw Error("Missing required webhook headers");if(!n)throw Error("Missing required body");if(!a)throw Error("Missing required secret");let o=`${r}.${i}.${n}`,l=await createHMACSHA256(a.split("_").pop(),o),u=s.split(" ").map(e=>e.split(",")[1]);return u.some(e=>e===l)}async function createHMACSHA256(e,t){let i=new TextEncoder,n=globalThis.crypto;void 0===n&&(n=r(81036).call(null,"node:crypto").webcrypto);let s=await n.subtle.importKey("raw",Uint8Array.from(atob(e),e=>e.codePointAt(0)),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),a=await n.subtle.sign("HMAC",s,i.encode(t));return bytesToBase64(a)}function bytesToBase64(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}async function withAutomaticRetries(e,t={}){let r=t.shouldRetry||(()=>!1),n=t.maxRetries||5,s=t.interval||500,a=t.jitter||100,sleep=e=>new Promise(t=>setTimeout(t,e)),o=0;do{let l=s*2**o+Math.random()*a;try{let t=await e();if(t.ok||!r(t))return t}catch(e){if(e instanceof i){let t=e.response.headers.get("Retry-After");if(t){if(Number.isInteger(t))l=1e3*t;else{let e=new Date(t);Number.isNaN(e.getTime())||(l=e.getTime()-new Date().getTime())}}}}Number.isInteger(n)&&n>0&&(Number.isInteger(l)&&l>0&&await sleep(s*2**(t.maxRetries-n)),o+=1)}while(o<n);return e()}async function transformFileInputs(e,t,r){switch(r){case"data-uri":return await transformFileInputsToBase64EncodedDataURIs(e,t);case"upload":return await transformFileInputsToReplicateFileURLs(e,t);case"default":try{return await transformFileInputsToReplicateFileURLs(e,t)}catch(e){if(e instanceof i&&e.response.status>=400&&e.response.status<500)throw e;return await transformFileInputsToBase64EncodedDataURIs(t)}default:throw Error(`Unexpected file upload strategy: ${r}`)}}async function transformFileInputsToReplicateFileURLs(e,t){return await transform(t,async t=>{if(t instanceof Blob||t instanceof Buffer){let r=await n.call(e,t);return r.urls.get}return t})}async function transformFileInputsToBase64EncodedDataURIs(e){let t=0;return await transform(e,async e=>{let r,i;if(e instanceof Blob)r=await e.arrayBuffer(),i=e.type;else{if(!isTypedArray(e))return e;r=e}if((t+=r.byteLength)>1e7)throw Error(`Combined filesize of prediction ${t} bytes exceeds 10mb limit for inline encoding, please provide URLs instead`);let n=bytesToBase64(r);return i=i||"application/octet-stream",`data:${i};base64,${n}`})}async function transform(e,t){if(Array.isArray(e)){let r=[];for(let i of e){let e=await transform(i,t);r.push(e)}return r}if(function(e){let t="object"==typeof e&&null!==e;if(!t||"[object Object]"!==String(e))return!1;let r=Object.getPrototypeOf(e);if(null===r)return!0;let i=Object.prototype.hasOwnProperty.call(r,"constructor")&&r.constructor;return"function"==typeof i&&i instanceof i&&Function.prototype.toString.call(i)===Function.prototype.toString.call(Object)}(e)){let r={};for(let i of Object.keys(e))r[i]=await transform(e[i],t);return r}return await t(e)}function isTypedArray(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}async function*streamAsyncIterator(e){let t=e.getReader();try{for(;;){let{done:e,value:r}=await t.read();if(e)return;yield r}}finally{t.releaseLock()}}e.exports={transform,transformFileInputs,validateWebhook,withAutomaticRetries,parseProgressFromLogs:function(e){let t="object"==typeof e&&e.logs?e.logs:e;if(!t||"string"!=typeof t)return null;let r=/^\s*(\d+)%\s*\|.+?\|\s*(\d+)\/(\d+)/,i=t.split("\n").reverse();for(let e of i){let t=e.match(r);if(t&&4===t.length)return{percentage:parseInt(t[1],10)/100,current:parseInt(t[2],10),total:parseInt(t[3],10)}}return null},streamAsyncIterator}},52968:e=>{async function getDefaultWebhookSecret(){let e=await this.request("/webhooks/default/secret",{method:"GET"});return e.json()}e.exports={default:{secret:{get:getDefaultWebhookSecret}}}},86035:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,s={};((e,r)=>{for(var i in r)t(e,i,{get:r[i],enumerable:!0})})(s,{EventSourceParserStream:()=>o}),e.exports=((e,s,a,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let a of i(s))n.call(e,a)||void 0===a||t(e,a,{get:()=>s[a],enumerable:!(o=r(s,a))||o.enumerable});return e})(t({},"__esModule",{value:!0}),s);var a=[239,187,191],o=class extends TransformStream{constructor(){let e;super({start(t){e=function(e){let t,r,i,n,s,o,l;return reset(),{feed:function(u){var c;r=r?r+u:u,t&&(c=r,a.every((e,t)=>c.charCodeAt(t)===e))&&(r=r.slice(a.length)),t=!1;let d=r.length,h=0,p=!1;for(;h<d;){let t;p&&("\n"===r[h]&&++h,p=!1);let a=-1,u=n;for(let e=i;a<0&&e<d;++e)":"===(t=r[e])&&u<0?u=e-h:"\r"===t?(p=!0,a=e-h):"\n"===t&&(a=e-h);if(a<0){i=d-h,n=u;break}i=0,n=-1,function(t,r,i,n){if(0===n){l.length>0&&(e({type:"event",id:s,event:o||void 0,data:l.slice(0,-1)}),l="",s=void 0),o=void 0;return}let a=i<0,u=t.slice(r,r+(a?n:i)),c=0;c=a?n:" "===t[r+i+1]?i+2:i+1;let d=r+c,h=n-c,p=t.slice(d,d+h).toString();if("data"===u)l+=p?"".concat(p,"\n"):"\n";else if("event"===u)o=p;else if("id"!==u||p.includes("\x00")){if("retry"===u){let t=parseInt(p,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else s=p}(r,h,u,a),h+=a+1}h===d?r="":h>0&&(r=r.slice(h))},reset};function reset(){t=!0,r="",i=0,n=-1,s=void 0,o=void 0,l=""}}(e=>{"event"===e.type&&t.enqueue(e)})},transform(t){e.feed(t)}})}}},93761:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,s={};((e,r)=>{for(var i in r)t(e,i,{get:r[i],enumerable:!0})})(s,{TextDecoderStream:()=>u}),e.exports=((e,s,a,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let a of i(s))n.call(e,a)||void 0===a||t(e,a,{get:()=>s[a],enumerable:!(o=r(s,a))||o.enumerable});return e})(t({},"__esModule",{value:!0}),s);var a=Symbol("decDecoder"),o=Symbol("decTransform"),l=class{constructor(e){this.decoder_=e}transform(e,t){if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw TypeError("Input data must be a BufferSource");let r=this.decoder_.decode(e,{stream:!0});0!==r.length&&t.enqueue(r)}flush(e){let t=this.decoder_.decode();0!==t.length&&e.enqueue(t)}},u=class{constructor(e,t){let r=new TextDecoder(e||"utf-8",t||{});this[a]=r,this[o]=new TransformStream(new l(r))}get encoding(){return this[a].encoding}get fatal(){return this[a].fatal}get ignoreBOM(){return this[a].ignoreBOM}get readable(){return this[o].readable}get writable(){return this[o].writable}};Symbol("encEncoder"),Symbol("encTransform")},69637:e=>{e.exports=JSON.parse('{"name":"replicate","version":"0.34.1","description":"JavaScript client for Replicate","repository":"github:replicate/replicate-javascript","homepage":"https://github.com/replicate/replicate-javascript#readme","bugs":"https://github.com/replicate/replicate-javascript/issues","license":"Apache-2.0","main":"index.js","type":"commonjs","types":"index.d.ts","files":["CONTRIBUTING.md","LICENSE","README.md","index.d.ts","index.js","lib/**/*.js","vendor/**/*","package.json"],"engines":{"node":">=18.0.0","npm":">=7.19.0","git":">=2.11.0","yarn":">=1.7.0"},"scripts":{"check":"tsc","format":"biome format . --write","lint-biome":"biome lint .","lint-publint":"publint","lint":"npm run lint-biome && npm run lint-publint","test":"jest"},"optionalDependencies":{"readable-stream":">=4.0.0"},"devDependencies":{"@biomejs/biome":"^1.4.1","@types/jest":"^29.5.3","@typescript-eslint/eslint-plugin":"^5.56.0","cross-fetch":"^3.1.5","jest":"^29.7.0","nock":"^14.0.0-beta.6","publint":"^0.2.7","ts-jest":"^29.1.0","typescript":"^5.0.2"}}')}};
//# sourceMappingURL=964.js.map